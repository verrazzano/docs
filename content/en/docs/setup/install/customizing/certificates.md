---
title: "Customize Certificates"
description: "Customize SSL certificate generation for Verrazzano system and application endpoints"
linkTitle: Certificates
weight: 2
draft: false
---

Verrazzano can be configured to issue certificates to secure access from external clients to the system and application endpoints in
the following configurations:

* Using a self-signed (the default) or user-provided certificate authority (CA).
* Using [LetsEncrypt](https://letsencrypt.org/) as the CA (requires [OCI DNS](https://docs.cloud.oracle.com/en-us/iaas/Content/DNS/Concepts/dnszonemanagement.htm)).

In both cases, Verrazzano uses [CertManager](https://cert-manager.io/) to create a
[`ClusterIssuer`](https://cert-manager.io/docs/reference/api-docs/#cert-manager.io/v1.ClusterIssuer) that will
manage the creation of certificates for use by Verrazzano system components.

{{< tabs tabTotal="2" tabID="2" tabName1="CA" tabName2="LetsEncrypt" >}}
{{< tab tabNum="1" >}}
<br>

## Use Self-Signed Certificates

Verrazzano supports using a local (in-cluster) CA to create certificates. It can create its own 
self-signed CA (the default case) or use a CA certificate that you provide.

{{< alert title="NOTE" color="warning" >}}
Self-signed Certificate Authorities generate certificates that are NOT signed by a trusted authority; they are not intended for production use.
{{< /alert >}}

If nothing is configured, Verrazzano will default to creating its own self-signed CA using CertManager.

If you wish to provide your own self-signed CA certificate, you must

* Create a CA secret and an [`Issuer`](https://cert-manager.io/docs/reference/api-docs/#cert-manager.io/v1.Issuer) resource as described 
  in the [CertManager CA documentation](https://cert-manager.io/docs/configuration/ca/)
* Specify the secret name and namespace location in the Verrazzano custom resource

The custom CA secret used to create the `Issuer` must be provided to CertManager using the following fields in
[`spec.components.certManager.certificate.ca`](/docs/reference/api/verrazzano/verrazzano#certificate) in the Verrazzano custom resource:

* `spec.components.certManager.certificate.ca.secretName`
* `spec.components.certManager.certificate.ca.clusterResourceNamespace`

For example, if you created a CA secret named `myca` in the namespace `myissuer`, you would configure it as shown below:

```
apiVersion: install.verrazzano.io/v1alpha1
kind: Verrazzano
metadata:
  name: custom-ca-example
spec:
  profile: dev
  components:
    certManager:
      certificate:
        ca:
          secretName: myca
          clusterResourceNamespace: myissuer
```

{{< /tab >}}
{{< tab tabNum="2" >}}
<br>

## Use LetsEncrypt Certificates

Verrazzano can be configured to use certificates generated by [LetsEncrypt](https://letsencrypt.org/).  LetsEncrypt
implements the [ACME protocol](https://tools.ietf.org/html/rfc8555) which provides a standard protocol for the 
automated issuance of certificates signed by a trusted authority.  This is managed through the 
[`spec.components.certManager.certificate.acme`](/docs/reference/api/verrazzano/verrazzano#acme) 
field in the Verrazzano custom resource.

{{< alert title="NOTE" color="info" >}}
Using LetsEncrypt for certificates also requires using OCI DNS for DNS management.
See the [Customize DNS](/docs/setup/install/customizing/dns/) page for details.
{{< /alert >}}

In order to use configure CertManager to use LetsEncrypt as the certificates provider, you must configure a CertManager 
ACME provider with the following values in the Verrazzano custom resource:

* Set the `spec.components.certManager.certificate.acme.provider` field to `letsEncrypt`.
* Set the `spec.components.certManager.certificate.acme.emailAddress` field to a valid email address for the `letsEncrypt` account
* (Optional) Set the `spec.components.certManager.certificate.acme.environment` field to either `staging` or `production` (the default)

The following example configures Verrazzano to use the LetsEncrypt `production` environment by default with OCI DNS 
for DNS record management:

```
apiVersion: install.verrazzano.io/v1alpha1
kind: Verrazzano
metadata:
  name: letsencrypt-certs-example
spec:
  profile: dev
  components:
    certManager:
      certificate:
        acme:
          provider: letsEncrypt
          emailAddress: jane.doe@mycompany.com
    dns:
      oci:
        ociConfigSecret: oci
        dnsZoneCompartmentOCID: ocid1.compartment.oc1.....
        dnsZoneOCID: ocid1.dns-zone.oc1.....
        dnsZoneName: mydomain.com
```

The following example configures Verrazzano to use the LetsEncrypt `staging` environment with OCI DNS:

```
apiVersion: install.verrazzano.io/v1alpha1
kind: Verrazzano
metadata:
  name: letsencrypt-certs-example
spec:
  profile: dev
  components:
    certManager:
      certificate:
        acme:
          provider: letsEncrypt
          emailAddress: jane.doe@mycompany.com
          environment: staging
    dns:
      oci:
        ociConfigSecret: oci
        dnsZoneCompartmentOCID: ocid1.compartment.oc1.....
        dnsZoneOCID: ocid1.dns-zone.oc1.....
        dnsZoneName: mydomain.com
```

{{< alert title="NOTE" color="warning" >}}
Certificates issued by the LetsEncrypt `staging` environment are signed by untrusted authorities, similar to 
the self-signed certificate authority.  They are not intended for production use.
{{< /alert >}}

#### LetsEncrypt staging vs production

LetsEncrypt provides rate-limits on generated certificates to ensure fair usage across all clients.  The 
`production` environment limits can be exceeded more frequently in environments where Verrazzano may be being 
installed or reinstalled frequently (like a test environment).  This can result in failed installations due to 
rate limit exceptions on certificate generation. 

In such environments it would be better to use the LetsEncrypt `staging` environment, which has much higher limits
than the `production` environment.  For test environments, the self-signed CA also may be more appropriate to completely
avoid LetsEncrypt rate limits.
{{< /tab >}}
